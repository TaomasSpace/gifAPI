<!doctype html>
<html lang="de">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Anime GIF API – Explorer</title>
    <style>
        :root {
            --bg: #0f1223;
            --card: #161a34;
            --ink: #e7e9ff;
            --muted: #9aa3c7;
            --acc: #7c9cff;
            --ok: #2ecc71;
            --err: #e74c3c;
        }

        * {
            box-sizing: border-box;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif
        }

        body {
            margin: 0;
            background: linear-gradient(120deg, #0f1223 0%, #13183a 70%)
        }

        .wrap {
            max-width: 980px;
            margin: 32px auto;
            padding: 0 16px
        }

        h1 {
            color: var(--ink);
            margin: 0 0 6px;
            font-weight: 800
        }

        p {
            color: var(--muted);
            margin-top: 6px
        }

        .card {
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .25);
            padding: 18px;
            margin: 16px 0
        }

        label {
            color: var(--ink);
            font-size: 14px;
            font-weight: 600;
            display: block;
            margin: 12px 0 6px
        }

        input[type="text"],
        input[type="url"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid rgba(255, 255, 255, .1);
            border-radius: 12px;
            background: #0e1330;
            color: var(--ink);
            outline: none
        }

        input:focus,
        select:focus {
            border-color: var(--acc)
        }

        .row {
            display: grid;
            gap: 16px
        }

        @media (min-width:720px) {
            .row.cols-2 {
                grid-template-columns: 1fr 1fr
            }

            .row.cols-3 {
                grid-template-columns: 1fr 1fr 1fr
            }
        }

        .btn {
            cursor: pointer;
            background: var(--acc);
            color: #080b1d;
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            font-weight: 700
        }

        .btn.secondary {
            background: #25305e;
            color: #cfe0ff
        }

        .actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 12px
        }

        code,
        pre {
            background: #0b1030;
            color: #cfe0ff;
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 10px
        }

        .mono {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace
        }

        pre {
            padding: 14px;
            white-space: pre-wrap
        }

        .muted {
            color: var(--muted);
            font-size: 13px
        }

        .status {
            margin-top: 10px;
            font-size: 14px
        }

        .status.ok {
            color: var(--ok)
        }

        .status.err {
            color: var(--err)
        }

        .copy {
            margin-left: 8px
        }
    </style>
</head>

<body>
    <div class="wrap">
        <h1>Anime GIF API – Explorer</h1>
        <p>Baue Anfragen an <code>/gifs</code>, bekomme die fertige URL und Beispiel-Code in Python. Wenn alle Felder
            leer sind, verwenden wir <code>/gifs?</code> und du erhältst ein zufälliges GIF.</p>

        <div class="card">
            <form id="form">
                <label for="base">API-Basis-URL</label>
                <input type="url" id="base" value="https://gifapi-tqh4.onrender.com" placeholder="https://deine-api.tld"
                    required />

                <div class="row cols-3">
                    <div>
                        <label for="q">Suche im Titel (<code>q</code>)</label>
                        <input type="text" id="q" placeholder="z. B. Nazuna" />
                        <div class="muted">Wenn gefüllt, <b>nicht</b> gleichzeitig tag/anime/character setzen.</div>
                    </div>
                    <div>
                        <label for="tag">Tag (<code>tag</code>)</label>
                        <select id="tag">
                            <option value="">— (leer)</option>
                        </select>
                        <div class="muted">Dropdown lädt: <code>GET /gifs?list=tags</code></div>
                    </div>
                    <div>
                        <label for="anime">Anime (<code>anime</code>)</label>
                        <input type="text" id="anime" placeholder="Call of the Night" />
                    </div>
                </div>

                <div class="row cols-3">
                    <div>
                        <label for="character">Character (<code>character</code>)</label>
                        <input type="text" id="character" placeholder="Nazuna" />
                    </div>
                    <div>
                        <label for="nsfw">NSFW-Modus (<code>nsfw</code>)</label>
                        <select id="nsfw">
                            <option value="false" selected>false (nur SFW)</option>
                            <option value="true">true (SFW + NSFW)</option>
                            <option value="only">only (nur NSFW)</option>
                        </select>
                    </div>
                    <div>
                        <label for="list">Liste (<code>list</code>)</label>
                        <select id="list">
                            <option value="">— (leer)</option>
                            <option value="tags">tags (alle Tags)</option>
                        </select>
                    </div>
                </div>

                <div class="row cols-3">
                    <div>
                        <label for="limit">Limit (<code>limit</code>)</label>
                        <input type="number" id="limit" min="1" max="200" placeholder="z. B. 50" />
                    </div>
                    <div>
                        <label for="offset">Offset (<code>offset</code>)</label>
                        <input type="number" id="offset" min="0" placeholder="z. B. 0" />
                    </div>
                    <div style="display:flex;align-items:flex-end">
                        <button class="btn" type="submit">URL & Code erzeugen</button>
                    </div>
                </div>
                <div id="formMsg" class="status"></div>
            </form>
        </div>

        <div class="card">
            <h3 style="color:var(--ink);margin:0 0 8px">Ergebnis</h3>
            <label>Fertige URL</label>
            <div class="actions">
                <code id="outUrl" class="mono">/gifs?</code>
                <button id="copyUrl" class="btn secondary copy" type="button">Kopieren</button>
                <button id="tryUrl" class="btn secondary" type="button">Ausführen</button>
            </div>

            <label style="margin-top:16px">Python (requests)</label>
            <pre id="pyBox" class="mono"></pre>
            <div class="actions">
                <button id="copyPy" class="btn secondary copy" type="button">Code kopieren</button>
            </div>

            <label style="margin-top:16px">Antwort (JSON)</label>
            <pre id="respBox" class="mono muted">—</pre>
        </div>
    </div>

    <script>
        const $ = s => document.querySelector(s);
        const byId = id => document.getElementById(id);

        const base = byId('base');
        const q = byId('q');
        const tag = byId('tag');
        const anime = byId('anime');
        const character = byId('character');
        const nsfw = byId('nsfw');
        const listSel = byId('list');
        const limit = byId('limit');
        const offset = byId('offset');

        const outUrl = byId('outUrl');
        const pyBox = byId('pyBox');
        const respBox = byId('respBox');
        const formMsg = byId('formMsg');

        // --- Hilfen ---
        function objToQuery(o) {
            const p = new URLSearchParams();
            for (const [k, v] of Object.entries(o)) {
                if (v === undefined || v === null || v === '') continue;
                p.append(k, String(v));
            }
            const qs = p.toString();
            return qs ? '/gifs?' + qs : '/gifs?'; // Wunsch: immer Fragezeichen wenn leer
        }

        function buildParams() {
            const params = {};
            // Regel: q XOR (tag|anime|character)
            const hasQ = q.value.trim() !== '';
            const singles = [tag.value, anime.value.trim(), character.value.trim()].filter(v => v);
            if (hasQ && singles.length > 0) {
                throw new Error("Entweder 'q' ODER eins von 'tag/anime/character' benutzen – nicht beides.");
            }
            if (!hasQ && singles.length > 1) {
                throw new Error("Bitte nur EINES von 'tag/anime/character' setzen.");
            }

            if (hasQ) params.q = q.value.trim();
            else {
                if (tag.value) params.tag = tag.value;
                else if (anime.value.trim()) params.anime = anime.value.trim();
                else if (character.value.trim()) params.character = character.value.trim();
            }

            if (listSel.value) params.list = listSel.value;
            if (nsfw.value) params.nsfw = nsfw.value;
            if (limit.value) params.limit = Number(limit.value);
            if (offset.value) params.offset = Number(offset.value);
            return params;
        }

        function render(baseUrl, qsPath, params) {
            const full = baseUrl.replace(/\/$/, '') + qsPath;
            outUrl.textContent = full;

            // Python snippet
            const py = `import requests

BASE = "${baseUrl.replace(/\/$/, '')}"
params = ${JSON.stringify(params, null, 2) || "{}"}
# Hinweis: Wenn params leer ist, liefert /gifs? ein zufälliges GIF
r = requests.get(f"{BASE}/gifs", params=params or None, timeout=10)
r.raise_for_status()
print(r.json())`;
            pyBox.textContent = py;
        }

        async function loadTags() {
            try {
                const url = base.value.replace(/\/$/, '') + '/gifs?list=tags';
                const r = await fetch(url);
                if (!r.ok) throw new Error(await r.text());
                const tags = await r.json();
                // Sortiert einfügen
                const old = tag.value;
                tag.innerHTML = '<option value="">— (leer)</option>' + (tags || []).map(t => `<option>${t}</option>`).join('');
                if ([...tag.options].some(o => o.value === old)) tag.value = old;
            } catch (e) {
                console.warn('Tags konnten nicht geladen werden:', e);
            }
        }

        // Initial Tags laden, wenn Basis-URL gesetzt ist
        window.addEventListener('load', loadTags);
        base.addEventListener('change', loadTags);

        // Formular submit
        byId('form').addEventListener('submit', async (ev) => {
            ev.preventDefault();
            formMsg.textContent = ''; formMsg.className = 'status';
            respBox.textContent = '—';
            try {
                const params = buildParams();
                const path = objToQuery(params);
                render(base.value, path, params);

                // Direkt ausführen?
                const url = base.value.replace(/\/$/, '') + '/gifs';
                const qs = new URLSearchParams(params);
                const r = await fetch(url + (qs.toString() ? ('?' + qs.toString()) : ''));
                const data = await r.json().catch(() => ({}));
                respBox.textContent = JSON.stringify(data, null, 2);
            } catch (err) {
                formMsg.textContent = err.message;
                formMsg.className = 'status err';
            }
        });

        // „Ausführen“ Button
        byId('tryUrl').addEventListener('click', async () => {
            try {
                const params = buildParams();
                const url = base.value.replace(/\/$/, '') + '/gifs';
                const qs = new URLSearchParams(params);
                const r = await fetch(url + (qs.toString() ? ('?' + qs.toString()) : ''));
                const data = await r.json().catch(() => ({}));
                respBox.textContent = JSON.stringify(data, null, 2);
            } catch (err) {
                respBox.textContent = 'Fehler: ' + err.message;
            }
        });

        // Copy-Buttons
        byId('copyUrl').addEventListener('click', async () => {
            try { await navigator.clipboard.writeText(outUrl.textContent); } catch { }
        });
        byId('copyPy').addEventListener('click', async () => {
            try { await navigator.clipboard.writeText(pyBox.textContent); } catch { }
        });

        // UX: Wenn 'q' gesetzt wird, andere Felder deaktivieren (und umgekehrt)
        function syncLocks() {
            const hasQ = q.value.trim() !== '';
            [tag, anime, character].forEach(el => el.disabled = hasQ);
            const singles = [tag.value, anime.value.trim(), character.value.trim()].filter(Boolean).length;
            q.disabled = singles > 0;
        }
        [q, tag, anime, character].forEach(el => el.addEventListener('input', syncLocks));
        window.addEventListener('load', syncLocks);
    </script>
</body>

</html>